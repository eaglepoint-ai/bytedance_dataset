{
  "instance_id": "subscription_manager_refactor_001",
  "problem_statement": "Refactor SubscriptionManager in subscription_manager.py to introduce a testable clock, encapsulated pricing and tier logic, and correct downgrade and corporate grace rules. You must preserve the legacy save_to_db(user_id, status, expiry) signature and keep process_tier_change as the main entry point while fixing time handling and edge cases.",
  "base_commit": "repository_before",
  "test_command": "pytest -q",
  "repo": "-",
  "environment_setup": "Dockerfile",
  "FAIL_TO_PASS": [
    "tests/test_refactor_constraints.py::test_premium_to_free_keeps_perks_until_month_end",
    "tests/test_refactor_constraints.py::test_corporate_gets_30_day_grace_window",
    "tests/test_refactor_constraints.py::test_supports_injected_clock_without_unittest_mock"
  ],
  "PASS_TO_PASS": [
    "tests/test_behavior_basics.py::test_free_cannot_access_premium_features",
    "tests/test_behavior_basics.py::test_expired_cannot_access_any_feature"
  ]
}